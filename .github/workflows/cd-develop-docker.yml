# Deploy pull and deploy docker image
name: cd-develop-docker
on: 
  push:
  workflow_dispatch:
jobs:
  deploy-docker:
    runs-on: [self-hosted, Windows, X64]
    env:
      DOCKER_IMAGE: mydockeruniversity/pocgithubactions:samplewebapplication-develop-latest
    steps:
      - name: Stop and remove current container
        run: |
          $result = docker container ls -a -q -f name=samplewebapplication-develop-latest
          if ($result -ne $NULL -and $result.Count -gt 0) {
            docker container stop samplewebapplication-develop-latest
            docker container rm samplewebapplication-develop-latest
          }
          
      - name: Pull docker image
        run: docker pull ${{ env.DOCKER_IMAGE }}
        
      - name: Start new container
        run: docker run -p 888:80 --name samplewebapplication-develop-latest ${{ env.DOCKER_IMAGE }}
        
    
